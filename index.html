<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Google Scholar Stats</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: "Times New Roman", serif; text-align: center; margin: 20px; background: #f8f8f8; }
        #badges { margin-bottom: 20px; }
        .badge { display: inline-block; background: #4285f4; color: white; padding: 6px 12px; border-radius: 12px; font-weight: bold; margin: 0 5px; font-size: 1rem; }
        #lastUpdated { margin-top: 8px; font-size: 0.9rem; color: #555; }
        #chart-container { width: 80%; max-width: 750px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        canvas { border-radius: 15px; }
    </style>
</head>
<body>
    <h1>Google Scholar</h1>
    <div id="badges">
        <span id="totalCitations" class="badge">Citations: 0</span>
        <span id="hIndex" class="badge">h-index: 0</span>
        <span id="i10Index" class="badge">i10-index: 0</span>
        <div id="lastUpdated">Last updated: --</div>
    </div>
    <div id="chart-container">
        <canvas id="citationsChart"></canvas>
    </div>

    <script>
        async function renderScholarChart() {
            // Cache-busting to always fetch latest JSON
            const response = await fetch('https://babakaslani.github.io/GoogleScholar/scholar_stats.json?cache=' + new Date().getTime());
            const data = await response.json();

            const years = Object.keys(data.citations_per_year).sort();
            const citations = years.map(y => data.citations_per_year[y]);

            // Update badges
            document.getElementById('totalCitations').textContent = 'Citations: ' + data.total_citations;
            document.getElementById('hIndex').textContent = 'h-index: ' + (data.h_index || 0);
            document.getElementById('i10Index').textContent = 'i10-index: ' + (data.i10_index || 0);
            document.getElementById('lastUpdated').textContent = "Last updated: " + (data.last_updated || "--");

            const ctx = document.getElementById('citationsChart').getContext('2d');

            // Gradient for each bar
            const barGradients = citations.map((c, i) => {
                const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                const factor = (i + 1) / years.length; // older → lighter, recent → darker
                gradient.addColorStop(0, `rgba(66,133,244, ${0.3 + 0.7 * factor})`);
                gradient.addColorStop(1, `rgba(66,133,244, ${0.8 + 0.2 * factor})`);
                return gradient;
            });

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Citations per Year',
                        data: citations,
                        backgroundColor: barGradients,
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: (tooltipItems) => `Year: ${tooltipItems[0].label}`,
                                label: (tooltipItem) => `Citations: ${tooltipItem.raw}`
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { font: { family: "Times New Roman", size: 14 } },
                            barPercentage: 0.6,
                            categoryPercentage: 0.7
                        },
                        y: {
                            beginAtZero: true,
                            ticks: { stepSize: 10, font: { family: "Times New Roman", size: 14 } },
                            grid: { color: '#e0e0e0' }
                        }
                    }
                }
            });
        }

        renderScholarChart();
    </script>
</body>
</html>

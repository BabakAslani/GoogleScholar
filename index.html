<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Google Scholar Replica</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Lato:wght@300&display=swap');

  body {
    font-family: 'Lato', sans-serif;
    font-weight: 300;
    font-size: 15px;
    text-align: center;
    margin: 20px;
    background: #f8f8f8;
  }

  h1 { font-weight: 300; margin-bottom: 10px; }

  #chart-container {
    width: 80%;
    max-width: 750px;
    margin: 30px auto;
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }

  canvas { border-radius: 15px; }

  .stats-container {
    width: 80%;
    max-width: 400px;
    margin: 20px auto 40px auto;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 15px 20px;
  }

  table {
    border-collapse: collapse;
    width: 100%;
    font-size: 14px;
  }

  th, td { padding: 6px 8px; }

  th {
    font-weight: 500;
    color: #555;
    border-bottom: 1px solid #ccc;
  }

  td { border-bottom: 1px solid #eee; }

  td:first-child { text-align: left; color: #444; font-weight: 500; }
  td:not(:first-child) { text-align: right; color: #222; }

  #lastUpdated { font-size: 0.9rem; color: #555; margin-top: 5px; }
</style>
</head>
<body>

<h1>Google Scholar</h1>

<div id="chart-container">
  <canvas id="citationsChart"></canvas>
</div>

<div class="stats-container">
  <table>
    <tr>
      <th></th>
      <th>All</th>
      <th>Since 2020</th>
    </tr>
    <tr>
      <td>Citations</td>
      <td id="citationsAll">--</td>
      <td id="citations2020">--</td>
    </tr>
    <tr>
      <td>h-index</td>
      <td id="hindexAll">--</td>
      <td id="hindex2020">--</td>
    </tr>
    <tr>
      <td>i10-index</td>
      <td id="i10All">--</td>
      <td id="i10_2020">--</td>
    </tr>
  </table>

  <div id="lastUpdated">Last updated: --</div>
</div>

<script>
async function renderScholarChart() {
    const url = 'https://babakaslani.github.io/GoogleScholar/scholar_stats.json?cache=' + new Date().getTime();
    let data;
    try {
        const resp = await fetch(url);
        data = await resp.json();
    } catch (e) {
        console.error('Failed to fetch scholar_stats.json:', e);
        return;
    }

    const years = Object.keys(data.citations_per_year || {}).sort();
    const citations = years.map(y => Number(data.citations_per_year[y] || 0));

    // total citations
    const totalCitations = data.total_citations ?? citations.reduce((a,b)=>a+b,0);

    // citations since 2020
    const citationsSince2020 = years.filter(y=>Number(y)>=2020).reduce((s,y)=>s + Number(data.citations_per_year[y]||0),0);

    // overall h-index & i10-index
    const hAll = data.h_index ?? '--';
    const i10All = data.i10_index ?? '--';

    // update table
    document.getElementById('citationsAll').textContent = totalCitations;
    document.getElementById('citations2020').textContent = citationsSince2020;
    document.getElementById('hindexAll').textContent = hAll;
    document.getElementById('hindex2020').textContent = data.h_index_recent;
    document.getElementById('i10All').textContent = i10All;
    document.getElementById('i10_2020').textContent = data.i10_index_recent;

    document.getElementById('lastUpdated').textContent = "Last updated: " + (data.last_updated || "--");

    // create chart with gradient bars
    const ctx = document.getElementById('citationsChart').getContext('2d');

    const barGradients = citations.map((c, i) => {
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        const factor = (i + 1) / years.length; // older → lighter, recent → darker
        const light = 180 + Math.round(50 * (1 - factor)); // 180 → 230 for older bars
        gradient.addColorStop(0, `rgba(${light},${light},${light},0.9)`);
        gradient.addColorStop(1, `rgba(${light},${light},${light},0.6)`);
        return gradient;
    });

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: years,
            datasets: [{
                label: 'Citations per Year',
                data: citations,
                backgroundColor: barGradients,
                borderRadius: 6,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            animation: { duration: 1600, easing: 'easeOutQuart' },
            plugins: { legend: { display: false } },
            scales: {
                x: {
                    grid: { display: false },
                    ticks: { font: { family: "Lato", size: 15, weight: 300 }, color: "#444" },
                    barPercentage: 0.3,
                    categoryPercentage: 0.5
                },
                y: {
                    beginAtZero: true,
                    position: 'right',
                    ticks: { font: { family: "Lato", size: 15, weight: 300 }, color: "#444" },
                    grid: { color: '#e0e0e0' }
                }
            }
        }
    });
}

renderScholarChart();
</script>

</body>
</html>
